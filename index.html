<!DOCTYPE html>
<html>
    <head>
        <title>Smart Table Widget</title>
        <script src="./js/ediable_table.js" type="module"></script>
        <link rel="stylesheet" href="css/styles.css" />
    </head>
    <body>
        <h1>Test of Simple table inline CRUD operations</h1>
        <table width="100%" id="smart-table">
            <thead>
                <tr>
                    <th data-type="index" data-name="index">Row index</th>
                    <th data-type="" data-name="uid">UUID</th>
                    <th data-type="int" data-name="field1">Integer</th>
                    <th data-type="float" data-name="field2">Floaing point</th>
                    <th data-type="bool" data-name="field3">Boolean</th>
                    <th data-type="text" data-name="field4">Text line</th>
                    <th data-type="select" data-name="field5">Multi-select</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>78761a4d-28fa-4072-93ce-c8131f3749d5</td>
                    <td>123</td>
                    <td>3.14159</td>
                    <td>Yes</td>
                    <td>Some demonstration text</td>
                    <td>Second</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>adf92e5e-54a9-4484-9e69-34c5b52c8049</td>
                    <td>456</td>
                    <td>1.41421356237</td>
                    <td>No</td>
                    <td>Some other text</td>
                    <td>Third</td>
                </tr>
            </tbody>
        </table>
        <div class="" id="add_button">
            <button id="add">Add a row</button>
            <button id="get_data">Get table data</button>
            <button id="populate">Set data in table</button>
            <div class="output"></div>
        </div>
        <script type="module">
            import EditableTable from './js/ediable_table.js'

            function uuidv4() {
                return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, c =>
                    (+c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> +c / 4).toString(16)
                );
            }

            const table = new EditableTable(
                document.getElementById('smart-table'),
                (is_new, index, data) => {
                    console.log(index);
                    console.log(data);
                    if (is_new) table.override_id(
                        index,
                        index + 2,
                        {
                            'uid': uuidv4()
                        }
                    );
                },
                (index) => {
                    console.log(index);
                },
                {
                    "fields": {
                        "field3": {
                            "labels": {
                                "true": "Yes",
                                "false": "No"
                            }
                        },
                        "field5": {
                            "options": {
                                "1": "First",
                                "2": "Second",
                                "3": "Third"
                            }
                        }
                    }
                }
            );

            const el_add = document.getElementById('add');
            el_add.addEventListener('click', (e) => {
                table.new_row();
            });

            const el_get_data = document.getElementById('get_data');
            el_get_data.addEventListener('click', (e) => {
                console.log(table.get_values());
            });

            const el_populate = document.querySelector('#populate');
            el_populate.addEventListener('click', (e) => {
                const table_data = [
                    {
                        'index': 1,
                        'field1': 987,
                        'field2': 1.3333333,
                        'field3': true,
                        'field4': 'Some text dynamically set',
                        'field5': '1'
                    },
                    {
                        'index': 2,
                        'field1': 654,
                        'field2': 2.1234,
                        'field3': false,
                        'field4': 'Other text',
                        'field5': '2'
                    }
                ];
                table.set_rows(table_data);
            });

            table.set_edit_callbacks(
                () => {
                    el_add.disabled = true;
                    el_get_data.disabled = true;
                    el_populate.disabled = true;
                },
                () => {
                    el_add.disabled = false;
                    el_get_data.disabled = false;
                    el_populate.disabled = false;
                }
            );
        </script>
    </body>
</html>